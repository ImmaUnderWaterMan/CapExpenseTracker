<Window x:Class="CapExpenseTracker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:CapExpenseTracker"
        Title="Трекер расходов" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <!-- Стиль для прогресс-баров -->
        <Style x:Key="ProgressBarStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Foreground" Value="#FF2E7D32"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="300"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>

        <!-- Панель инструментов -->
        <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="10" Background="#f0f0f0">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="btnAdd" Content="Добавить расход" 
                        Command="{Binding AddExpenseCommand}"
                        Margin="5" Padding="10,5" Width="120"/>
                <Button x:Name="btnEdit" Content="Редактировать" 
                        Command="{Binding EditExpenseCommand}"
                        Margin="5" Padding="10,5" Width="100"/>
                <Button x:Name="btnDelete" Content="Удалить" 
                        Command="{Binding DeleteExpenseCommand}"
                        Margin="5" Padding="10,5" Width="80"/>
                <Button x:Name="btnShowStats" Content="Показать статистику" 
                        Command="{Binding ShowStatisticsCommand}"
                        Margin="5" Padding="10,5" Width="140"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                <TextBlock Text="Период:" VerticalAlignment="Center" Margin="5" Width="50"/>
                <ComboBox x:Name="cmbPeriod" 
                          ItemsSource="{Binding Periods}"
                          SelectedItem="{Binding SelectedPeriod}"
                          Margin="5" Width="100"/>

                <TextBlock Text="Тип расхода:" VerticalAlignment="Center" Margin="5" Width="80"/>
                <ComboBox x:Name="cmbExpenseType" 
                          ItemsSource="{Binding ExpenseTypes}"
                          SelectedItem="{Binding SelectedExpenseType}"
                          Margin="5" Width="120"/>
            </StackPanel>
        </StackPanel>

        <!-- Таблица расходов -->
        <DataGrid Grid.Row="1" Grid.Column="0" Margin="10" 
                  ItemsSource="{Binding ExpensesView}"
                  SelectedItem="{Binding SelectedExpense}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  CanUserSortColumns="True"
                  Sorting="DataGrid_Sorting">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}" 
                                   Width="100" CanUserSort="True"/>
                <DataGridTextColumn Header="Тип расхода" Binding="{Binding TypeExpense}" 
                                   Width="150" CanUserSort="True"/>
                <DataGridTextColumn Header="Сумма" Binding="{Binding Amount, StringFormat={}{0} руб.}" 
                                   Width="100" CanUserSort="True"/>
                <DataGridTextColumn Header="Пробег" Binding="{Binding CurrentRun, StringFormat={}{0} км}" 
                                   Width="80" CanUserSort="True"/>
                <DataGridTextColumn Header="Описание" Binding="{Binding Comment}" 
                                   Width="*" CanUserSort="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Панель статистики -->
        <Border Grid.Row="1" Grid.Column="1" Margin="0,10,10,10" BorderBrush="LightGray" BorderThickness="1">
            <ScrollViewer>
                <StackPanel Margin="10">
                    <TextBlock Text="Статистика" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

                    <Grid Margin="0,0,0,10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Общая сумма расходов:"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalAmount, StringFormat={}{0} руб.}" 
                                   FontWeight="Bold" Margin="10,0,0,0"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Средний расход в месяц:"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding AverageMonthly, StringFormat={}{0} руб.}" 
                                   FontWeight="Bold" Margin="10,0,0,0"/>
                    </Grid>

                    <TextBlock Text="Расход по категориям:" FontWeight="SemiBold" Margin="0,10,0,5"/>

                    <!-- Прогресс-бары по категориям -->
                    <ItemsControl ItemsSource="{Binding CategoryStats}" Margin="0,5,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="0,5">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="60"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding Category}" 
                                                   FontWeight="SemiBold" Margin="0,0,5,2"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Amount, StringFormat={}{0} руб.}" 
                                                   HorizontalAlignment="Right" Margin="0,0,5,2"/>
                                        <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding Percentage, StringFormat={}{0:F1}%}" 
                                                   HorizontalAlignment="Right"/>

                                        <ProgressBar Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" 
                                                     Value="{Binding Percentage}"
                                                     Maximum="100"
                                                     Style="{StaticResource ProgressBarStyle}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Панель сортировки -->
        <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Margin="10" Background="#f8f8f8">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Сортировка:" VerticalAlignment="Center" Margin="5" Width="70"/>
                <Button x:Name="btnSortDate" Content="По дате" 
                        Command="{Binding SortByDateCommand}"
                        Margin="5" Padding="10,5" Width="80"/>
                <Button x:Name="btnSortAmount" Content="По сумме" 
                        Command="{Binding SortByAmountCommand}"
                        Margin="5" Padding="10,5" Width="80"/>
                <Button x:Name="btnSortMileage" Content="По пробегу" 
                        Command="{Binding SortByMileageCommand}"
                        Margin="5" Padding="10,5" Width="80"/>
                <TextBlock Text="Или щелкните по заголовку колонки в таблице" 
                           VerticalAlignment="Center" Margin="10,5" FontStyle="Italic" Foreground="Gray"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>